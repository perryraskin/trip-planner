# Migration `20201022034959-trip-notes`

This migration has been generated by Perry Raskin at 10/21/2020, 11:49:59 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "public"."User" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"name" text   NOT NULL ,
"email" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Trip" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"userId" integer   ,
"nickname" text   NOT NULL ,
"dateStart" timestamp(3)   NOT NULL ,
"dateEnd" timestamp(3)   NOT NULL ,
"headerImageUrl" text   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TripNote" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"tripId" integer   ,
"tripNoteType" integer   NOT NULL ,
"tag" text   NOT NULL ,
"title" text   NOT NULL ,
"subtitle" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TripNoteCost" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"tripNoteId" integer   ,
"amount" Decimal(65,30)   NOT NULL ,
"currency" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TripNoteItem" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"tripNoteId" integer   ,
"title" text   NOT NULL ,
"subtitle" text   NOT NULL ,
"details" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."TripNoteImage" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"tripNoteItemId" integer   ,
"name" text   NOT NULL ,
"sourceUrl" text   NOT NULL ,
"tripNoteId" integer   ,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."Trip" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."TripNote" ADD FOREIGN KEY ("tripId")REFERENCES "public"."Trip"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."TripNoteCost" ADD FOREIGN KEY ("tripNoteId")REFERENCES "public"."TripNote"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."TripNoteItem" ADD FOREIGN KEY ("tripNoteId")REFERENCES "public"."TripNote"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."TripNoteImage" ADD FOREIGN KEY ("tripNoteItemId")REFERENCES "public"."TripNoteItem"("id") ON DELETE SET NULL ON UPDATE CASCADE

DROP TABLE "public"."Trips"

DROP TABLE "public"."Users"
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201020021258-trips-fix..20201022034959-trip-notes
--- datamodel.dml
+++ datamodel.dml
@@ -2,25 +2,73 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
-model Users {
+model User {
   id        Int      @id @default(autoincrement())
   createdAt DateTime @default(now())
   name      String
   email     String
+  Trips     Trip[]
 }
-model Trips {
-  id        Int      @id @default(autoincrement())
-  createdAt DateTime @default(now())
-  nickname  String
-  dateStart DateTime
-  dateEnd   DateTime
+model Trip {
+  id             Int        @id @default(autoincrement())
+  createdAt      DateTime   @default(now())
+  userId         Int?
+  nickname       String
+  dateStart      DateTime
+  dateEnd        DateTime
+  headerImageUrl String?
+  User           User?      @relation(fields: [userId], references: [id])
+  TripNotes      TripNote[]
 }
+
+model TripNote {
+  id            Int            @id @default(autoincrement())
+  createdAt     DateTime       @default(now())
+  tripId        Int?
+  tripNoteType  Int
+  tag           String
+  title         String
+  subtitle      String
+  Trip          Trip?          @relation(fields: [tripId], references: [id])
+  TripNoteCosts TripNoteCost[]
+  TripNoteItems TripNoteItem[]
+}
+
+model TripNoteCost {
+  id         Int       @id @default(autoincrement())
+  createdAt  DateTime  @default(now())
+  tripNoteId Int?
+  amount     Float
+  currency   String
+  TripNote   TripNote? @relation(fields: [tripNoteId], references: [id])
+}
+
+model TripNoteItem {
+  id             Int             @id @default(autoincrement())
+  createdAt      DateTime        @default(now())
+  tripNoteId     Int?
+  title          String
+  subtitle       String
+  details        String
+  TripNote       TripNote?       @relation(fields: [tripNoteId], references: [id])
+  TripNoteImages TripNoteImage[]
+}
+
+model TripNoteImage {
+  id             Int           @id @default(autoincrement())
+  createdAt      DateTime      @default(now())
+  tripNoteItemId Int?
+  name           String
+  sourceUrl      String
+  TripNoteItem   TripNoteItem? @relation(fields: [tripNoteItemId], references: [id])
+  tripNoteId     Int?
+}
```


